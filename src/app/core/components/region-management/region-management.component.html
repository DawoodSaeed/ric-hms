<h3
  class="font-bold pl-4 color-gray text-2xl subpixel-antialiased text-gray-800 uppercase"
>
  Countries
</h3>

<app-breadcrumb></app-breadcrumb>

<!-- <p-breadcrumb class="max-w-full" [model]="" /> -->
<!-- @let users = users$ | async; -->
@let countries=countries$ | async;
<p-table
  [scrollable]="true"
  scrollHeight="flex"
  #dt
  [value]="countries || []"
  dataKey="id"
  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
  [showCurrentPageReport]="true"
  [size]="'large'"
  [tableStyle]="{ 'min-width': '60rem' }"
  [paginator]="true"
  [rows]="10"
  stripedRows
  responsiveLayout="scroll"
  class="custom-table w-full overflow-x-auto"
  [rowsPerPageOptions]="[5, 10, 20]"
  [globalFilterFields]="['name']"
  stateStorage="session"
  stateKey="statedemo-session"
>
  <!-- [loading]="isLoading()" -->
  <ng-template #caption>
    <div class="flex flex-wrap gap-2">
      <p-button label="Clear" [outlined]="true" icon="pi pi-filter-slash" />
      <!-- (click)="clear(dt)" -->
      <p-button
        p-button
        icon="pi pi-plus"
        label="Add {{ this.dataType }}"
        styleClass="ml-2"
        (click)="formState.set('addItem'); displayDialogBox.set(true)"
      />
      <p-iconfield iconPosition="left" class="ml-auto">
        <p-inputicon>
          <i class="pi pi-search"></i>
        </p-inputicon>
        <input
          pInputText
          type="text"
          (input)="dt.filterGlobal($any($event.target).value, 'contains')"
          placeholder="Keyboard Search"
          class="w-full md:w-56"
        />
      </p-iconfield>
    </div>
  </ng-template>
  <ng-template pTemplate="header" let-columns>
    <tr>
      <th *ngFor="let country of tableHeadings$ | async">
        {{ country | titlecase }}
      </th>
      <th>Actions</th>
    </tr>
  </ng-template>
  <ng-template
    pTemplate="body"
    let-rowData
    let-columns="columns"
    let-rowIndex="rowIndex"
  >
    <tr [pSelectableRow]="rowData">
      <td
        *ngFor="
          let heading of getTableHeadings(countries ?? []);
          trackBy: trackByID
        "
        class="text-center text-justify"
      >
        <ng-container *ngIf="heading === 'status'; else defaultCell">
          <p-tag
            [severity]="rowData[heading] === 1 ? 'success' : 'danger'"
            [value]="getTagValue(rowData[heading])"
            [rounded]="true"
          />
        </ng-container>
        <ng-template #defaultCell>
          {{ rowData[heading] ?? "-" }}
        </ng-template>
      </td>
      <td>
        <button
          pButton
          icon="pi pi-pencil"
          class="p-button-rounded p-button-text"
          pTooltip="Edit User"
          tooltipPosition="top"
          (click)="editItem(rowData)"
        ></button>

        <button
          pButton
          icon="pi pi-trash"
          class="p-button-rounded p-button-text p-button-danger"
          pTooltip="Delete User"
          tooltipPosition="top"
        ></button>
        <!-- (click)="deleteUser(rowData)" -->
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [visible]="displayDialogBox()"
  styleClass="w-full md:w-[40rem]"
  [closable]="false"
  [maximizable]="true"
>
  <!-- (onHide)="dialogClose()" -->
  <ng-template #header>
    <div class="flex items-center justify-between w-full">
      <h3 class="font-semibold text-lg">
        @if(formState() == 'addItem'){ Add {{ this.dataType }} } @if(formState()
        == 'editItem'){ Edit {{ this.dataType }} }
      </h3>
      <button
        pButton
        icon="pi pi-times"
        (click)="displayDialogBox.set(false)"
        class="p-button-rounded p-button-text"
      ></button>
    </div>
  </ng-template>

  <!-- To add the building ############## -->
  <ng-container *ngIf="dataType === 'Country'">
    <div
      class="grid grid-cols-1 md:grid-cols-[120px_1fr] gap-4 mb-4 items-center"
    >
      <label for="name" class="font-medium flex"
        >Country Name

        <span class="text-red-400 font-bold">*</span>
      </label>
      <input
        pInputText
        id="name"
        placeholder="Country Name"
        required
        [(ngModel)]="newCountry.name"
        class="w-full p-2 border rounded focus:outline-none focus:ring focus:border-blue-300"
      />
    </div>
    <div
      class="grid grid-cols-1 md:grid-cols-[120px_1fr] gap-4 mb-4 items-center"
    >
      <label for="name" class="font-medium flex"
        >Code

        <span class="text-red-400 font-bold">*</span>
      </label>
      <input
        pInputText
        id="name"
        placeholder="Code"
        required
        [(ngModel)]="newCountry.code"
        class="w-full p-2 border rounded focus:outline-none focus:ring focus:border-blue-300"
      />
    </div>
    <div
      class="grid grid-cols-1 md:grid-cols-[120px_1fr] gap-4 mb-4 items-center"
    >
      <label for="name" class="font-medium flex"
        >Phone Code

        <span class="text-red-400 font-bold">*</span>
      </label>
      <input
        pInputText
        id="pCode"
        placeholder="Phone Code"
        required
        [(ngModel)]="newCountry.phoneCode"
        class="w-full p-2 border rounded focus:outline-none focus:ring focus:border-blue-300"
      />
    </div>
    <div
      class="grid grid-cols-1 md:grid-cols-[120px_1fr] gap-4 mb-4 items-center"
    >
      <label for="name" class="font-medium"
        >Currency Code

        <span class="text-red-400 font-bold">*</span>
      </label>
      <input
        pInputText
        id="pCode"
        placeholder="Currency Code"
        required
        [(ngModel)]="newCountry.currencyCode"

        class="w-full p-2 border rounded focus:outline-none focus:ring focus:border-blue-300"
      />
    </div>

    <!-- <div
      class="grid grid-cols-1 md:grid-cols-[120px_1fr] gap-4 mb-4 items-start"
    >
      <label for="description" class="font-medium"
        >Status
        <span class="text-red-400 font-bold">*</span>
      </label>
      <p-checkbox [binary]="true" />
    </div> -->
  </ng-container>
     <div class="flex justify-end mt-4">
      <button
        pButton
        label="Save"
        (click)="addOrUpdateItem()"
        class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded"
      ></button>
    </div>
</p-dialog>
